---
title: "Understanding demographic variations in health insurance coverage in the United States: evidence from wave 5 of ADD Health survey"
subtitle: "EDLD 651 Final Paper"
author: "Sara Kiros, Ohnmar Khine Min, Chen Su"
format: 
  html:
    toc: true
execute: 
  eval: true
  echo: false
  warning: false
fig-width: 6.5
fig-height: 8
---



```{r}
#| label: load-packages-raw-data

library(tidyverse)
library(here)
library(rio)
library(janitor)
library(gt)
#install.packages("webshot2")
#install.packages("labeled")
library(labelled)
library(webshot2)

pwave5 <- import(here("data", "pwave5.xpt")) |>
  characterize() |>
  clean_names() 

```



```{r}
#| label: select-variables

wave5_raw <- pwave5 |>
     select(aid, imonth5, iyear5, h5od1m, h5od1y,
            h5od2a, h5od3, h5od4a, h5od4b, h5od4c,
            h5od4d, h5od4e, h5od4f, h5od4g, h5od8,
            h5lm5, h5lm6, h5lm7, h5lm9, h5ec1, h5ec2,
            h5id9, h5id10a, h5id10b, h5id10c, h5id10d)

```



```{r}
#| label: clean-employment

#Job Type
job_labels <- c(
  "1" = "Military", 
  "2" = "Private for-profit", 
  "3" = "Private nonprofit",
  "4" = "Local government",
  "5" = "State government", 
  "6" = "Federal government", 
  "7" = "Self-employed (non-inc)",
  "8" = "Self-employed (inc)",
  "9" = "Unpaid family worker"
  )


wave5_clean <- wave5_raw |> 
    mutate(
    employed = ifelse(h5lm5 == 1, "Employed",
                      ifelse(h5lm5 %in% c(2, 3), "Not employed", NA)),
    num_jobs = ifelse(h5lm6 %in% 1:4, h5lm6, NA),
    hours_work = ifelse(h5lm7 >= 5 & h5lm7 <= 90, h5lm7, NA),
     job_type = job_labels[as.character(h5lm9)]
)

#Distribution of Job Types - Bar Chart
ggplot(wave5_clean, aes(x = job_type)) + 
  geom_bar() +
  coord_flip() + 
  labs(title = "Distribution of Job Types Among Participants", 
       x = "Job Type", 
       y = "Count")
  
```



```{r}

wave5_clean <- wave5_clean |> 
  mutate(
    gender = ifelse(h5od2a == 1, "Male", 
                    ifelse(h5od2a == 2, "Female", NA))
  )

#gender_employment
gender_employment <- wave5_clean |> 
  group_by (gender, employed) |>
  summarize(n = n(), .groups = "drop")

#gender_employment plot
ggplot(gender_employment, aes(x = gender, y = n, fill = employed)) + 
  geom_col(position = "dodge", na.rm = TRUE) + 
  labs(title = "Employment Status by Gender", 
       x = "Gender",
       y = "Count",
       fill = "Employment")
```



```{r}


#Health insurance status (h5id9 & h5id10a,b,c,d)
wave5_clean <- wave5_raw %>%
  mutate(
    h5id9 = factor(
      h5id9,
      levels = c(1, 2, 4, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15),
      labels = c(
        "I get insurance through work",
        "I get insurance through a union",
        "I am covered by my spouse’s or partner’s insurance",
        "I am covered because I am active duty military",
        "I buy private insurance myself",
        "I buy insurance through a Health Insurance Marketplace or Exchange (ACA)",
        "I am on Medicaid",
        "I am on Medicare",
        "I get care through the Department of Veterans Affairs",
        "I am covered through TRI-CARE, CHAMPUS, CHAMP-VA, or other military plan",
        "I am covered through the Indian Health Service",
        "I do not know what my health insurance is",
        "I have no health insurance"
      )
    )
  )

# Factor: Q10 reasons (0 = no, 1 = yes, 97 = legitimate skip)
wave5_clean <- wave5_raw %>%
  mutate(across(
    c(h5id10a, h5id10b, h5id10c, h5id10d),
    ~ factor(.,
             levels = c(0, 1, 97),
             labels = c("no", "yes", "legitimate skip"))
  ))
```



```{r}
#Renaming Column names 

wave5_clean <- wave5_raw %>%
  rename(
    insurance_status = h5id9,
    reason_a_not_offered_thru_work_or_school = h5id10a,
    reason_b_too_expensive = h5id10b,
    reason_c_no_need_or_want = h5id10c,
    reason_d_denied_insurance = h5id10d,
    household_income = h5ec2
  )
var_label(wave5_clean$household_income)<-"Household Income h5sec2"




#Household Income in the last calendar year (h5ec2)

wave5_clean <- wave5_clean %>%
  mutate(
    household_income = factor(
      household_income,
      levels = 1:13,
      labels = c(
        "Less than $5,000",
        "$5,000 to $9,999",
        "$10,000 to $14,999",
        "$15,000 to $19,999",
        "$20,000 to $24,999",
        "$25,000 to $29,999",
        "$30,000 to $39,999",
        "$40,000 to $49,999",
        "$50,000 to $74,999",
        "$75,000 to $99,999",
        "$100,000 to $149,999",
        "$150,000 to $199,999",
        "$200,000 or more"
      )
    )
  )

#WORK IN PROGRESS_Collapsing Insurance variable

wave5_clean<- wave5_clean %>%
  mutate(
    household_income2 = fct_collapse(household_income,
      low_income = c("Less than $5,000", "$5,000 to $9,999", "$10,000 to $14,999"),
      middle_income = c("$15,000 to $19,999",
      "$20,000 to $24,999",
      "$25,000 to $29,999",
      "$30,000 to $39,999",
      "$40,000 to $49,999"), 
      high_income=  c("$50,000 to $74,999",
        "$75,000 to $99,999",
        "$100,000 to $149,999",
        "$150,000 to $199,999",
        "$200,000 or more")))


#fct_count(df$household_income2)



```


```{r}
#TEST pivoting
#wave5_pivot <- wave5_clean %>% pivot_longer(cols = reason_a_not_offered_thru_work_or_school:reason_d_denied_insurance, 
                                            #names_to = "count_uninsure")




```



**Data Exploratory visualization for Household Income Count**
```{r}
wave5_clean %>%
  filter(!is.na(household_income)) %>%
  group_by(household_income) %>%
  summarise(count = n()) %>%
  ggplot(aes(x = factor(household_income,
                        levels = 1:13,
                        labels = c(
                          "Less than $5,000",
                          "$5,000 to $9,999",
                          "$10,000 to $14,999",
                          "$15,000 to $19,999",
                          "$20,000 to $24,999",
                          "$25,000 to $29,999",
                          "$30,000 to $39,999",
                          "$40,000 to $49,999",
                          "$50,000 to $74,999",
                          "$75,000 to $99,999",
                          "$100,000 to $149,999",
                          "$150,000 to $199,999",
                          "$200,000 or more"
                        )),
                 y = count)) +
  geom_col() +
  labs(title = "Count by Income Level", x = "Household Income Level", y = "Count") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


```



```{r}
#| label: convert-date-variables

survey_date_string <- paste(wave5_clean$iyear5, wave5_clean$imonth5, 1, sep = "-")

wave5_clean <- wave5_clean |>
  mutate(survey_date = ymd(survey_date_string))


birth_date_string <- paste(wave5_clean$h5od1y, wave5_clean$h5od1m, 1, sep = "-")

wave5_clean <- wave5_clean |>
  mutate(birth_date = ymd(birth_date_string))

```



```{r}
#| label: calculate-age-at-survey

wave5_clean <- wave5_clean |>
  mutate(age = interval(birth_date, survey_date) |>
           time_length(unit = "years") |> round(digits = 2))

wave5_clean |>
  ggplot(aes(x=age)) + geom_histogram(binwidth = 1,
                                      fill="skyblue", color="white", alpha=0.8) + 
  labs(x = "Age at Wave 5",
       y = "Number of Participants",
    title = "Distribution of Participant's Age",
       caption = "Data Source: Wave 5 ADD Health") + 
  theme_minimal()


```



```{r}
#| label: convert-race-ethnicity-variables

wave5_clean <- wave5_clean |>
  mutate(race = case_when(h5od4a == 1 & h5od4b == 0 & h5od4d == 0 & h5od4e == 0 &
                            h5od4f == 0 & h5od4g == 0 ~ "White", 
                          h5od4a == 0 & h5od4b == 1 & h5od4d == 0 & h5od4e == 0 &
                            h5od4f == 0 & h5od4g == 0 ~ "Black", 
                          h5od4a == 0 & h5od4b == 0 & h5od4d == 1 & h5od4e == 0 &
                            h5od4f == 0 & h5od4g == 0 ~ "Asian", 
                          h5od4a == 0 & h5od4b == 0 & h5od4d == 0 & h5od4e == 1 &
                            h5od4f == 0 & h5od4g == 0 ~ "Pacific Islander", 
                          h5od4a == 0 & h5od4b == 0 & h5od4d == 0 & h5od4e == 0 &
                            h5od4f == 1 & h5od4g == 0 ~ "American Indian or Alaska Native",
                          h5od4a == 0 & h5od4b == 0 & h5od4d == 0 & h5od4e == 0 &
                            h5od4f == 0 & h5od4g == 1 ~ "Other Race"))

# NA = multiple race selected, recode to multiracial
wave5_clean <- wave5_clean |>
  mutate(race = replace_na(race, "Multiracial"))


# ethnicity
wave5_clean <- wave5_clean |>
  mutate(ethnicity = case_when(h5od4c == 1 ~ "Hispanic",
                               h5od4c == 0 ~ "Non-Hispanic"))

# NA = Missing for ethnicity
wave5_clean <- wave5_clean |>
  mutate(ethnicity = replace_na(ethnicity, "Missing"))
    
# re-level variables
wave5_clean$race <- factor(wave5_clean$race,levels = c("White",
                                                       "Black",
                                                       "Asian",
                                                       "Pacific Islander",
                                                       "American Indian or Alaska Native",
                                                       "Multiracial",
                                                       "Other Race"))

wave5_clean$ethnicity <- factor(wave5_clean$ethnicity,
                                levels = c("Non-Hispanic",
                                           "Hispanic",
                                           "Missing"))

```


```{r}
#| label: visual-race-ethnicity

wave5_clean |>
  ggplot(aes(race)) + geom_bar(fill = "darkgreen") + 
  labs(title = "Distribution of Participant's Race and Ethnicity",
       caption = "Data Source: Wave 5 ADD Health") + 
  theme_minimal() + facet_wrap(~ethnicity) + coord_flip()

# just race
wave5_clean |>
  ggplot(aes(race)) + geom_bar(fill = "darkgreen") + 
  labs(title = "Distribution of Participant's Race",
       caption = "Data Source: Wave 5 ADD Health") + 
  theme_minimal() + coord_flip()

# just ethnicity
wave5_clean |>
  ggplot(aes(ethnicity)) + geom_bar(fill = "darkorange") + 
  labs(title = "Distribution of Participant's Ethnicity",
       caption = "Data Source: Wave 5 ADD Health") + 
  theme_minimal() + coord_flip()

# table

race_ethnicity_table <- wave5_clean |>
  count(race, ethnicity) |>
  group_by(ethnicity) |>
  gt() |>
  tab_header(title = "Descriptive Statistics: Race and Ethnicity") |>
  cols_label(
    race = "Race",
    ethnicity = "Ethnicity"
    )


```


```{r}
#| label: table-income

income_labels <- c(
  "Less than $5,000",
  "$5,000 to $9,999",
  "$10,000 to $14,999",
  "$15,000 to $19,999",
  "$20,000 to $24,999",
  "$25,000 to $29,999",
  "$30,000 to $39,999",
  "$40,000 to $49,999",
  "$50,000 to $74,999",
  "$75,000 to $99,999",
  "$100,000 to $149,999",
  "$150,000 to $199,999",
  "$200,000 or more"
)

incometable <- wave5_clean %>%
  filter(!is.na(household_income)) %>%
  mutate(household_income = factor(household_income, levels = 1:13, labels = income_labels)) %>%
  count(household_income, name = "count") %>%
  mutate(percent = count / sum(count)) %>%
  gt() %>%
  tab_header(title = "Descriptive Statistics: Household Income") %>%
  cols_label(
    household_income = "Household Income Level",
    count = "Count",
    percent = "Percent"
  ) %>%
  fmt_percent(columns = percent, decimals = 1) %>%
  cols_align(align = "left", columns = household_income) %>%
  cols_align(align = "right", columns = c(count, percent))
  
gtsave(incometable, filename = "incometable.png")

```
```{r}
#| label: table-health-insurance

insurance_labels <- c(
  "I get insurance through work",
  "I get insurance through a union",
  "I am covered by my spouse’s or partner’s insurance",
  "I am covered because I am active duty military",
  "I buy private insurance myself",
  "I buy insurance through a Health Insurance Marketplace or Exchange (ACA)",
  "I am on Medicaid",
  "I am on Medicare",
  "I get care through the Department of Veterans Affairs",
  "I am covered through TRI-CARE, CHAMPUS, CHAMP-VA, or other military plan",
  "I am covered through the Indian Health Service",
  "I do not know what my health insurance is",
  "I have no health insurance"
)

insurance_table <- wave5_clean %>%
  filter(!is.na(insurance_status)) %>%
  mutate(insurance_status = factor(insurance_status,
                                   levels = c(1, 2, 4, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15),
                                   labels = insurance_labels)) %>%
  count(insurance_status, name = "count") %>%
  mutate(percent = count / sum(count)) %>%
  gt() %>%
  tab_header(title = "Descriptive Statistics: Health Insurance Status") %>%
  cols_label(
    insurance_status = "Insurance Status",
    count = "Count",
    percent = "Percent"
  ) %>%
  fmt_percent(columns = percent, decimals = 1) %>%
  cols_align(align = "left", columns = insurance_status) %>%
  cols_align(align = "right", columns = c(count, percent))


#insurance_table

gtsave(insurance_table, filename = "insurance_table_1.png")

```


```{r}

#| label: exploratory-insurance-income


income_labels <- c(
  "Less than $5,000",
  "$5,000 to $9,999",
  "$10,000 to $14,999",
  "$15,000 to $19,999",
  "$20,000 to $24,999",
  "$25,000 to $29,999",
  "$30,000 to $39,999",
  "$40,000 to $49,999",
  "$50,000 to $74,999",
  "$75,000 to $99,999",
  "$100,000 to $149,999",
  "$150,000 to $199,999",
  "$200,000 or more"
)

no_insurance_income <- wave5_clean %>%
  filter(insurance_status == 15, !is.na(household_income)) %>%
  mutate(household_income = factor(household_income,
                                   levels = 1:13,
                                   labels = income_labels)) %>%
  count(household_income)


ggplot(no_insurance_income, aes(x = household_income, y = n)) +
  geom_col(fill = "#2C7BB6") +
  labs(title = "Counts of Respondents with No Health Insurance by Income Level",
       x = "Household Income Level",
       y = "Count") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```




## Abstract
[1-2 Sentences about study rationale.] The current study examines the variations of health insurance status across demographic characteristics including race, ethnicity, age, sex, employment, income using Wave V of ADD Health survey data. [summarize finding here: We found that....]. It is critical to address disparities in health insurance status as improved access to care for diverse population is crucial for the successful prevention and management of chronic health conditions for all.

## Introduction
(1-2 paragraphs) Describe here why we are examining these demographic variables and health insurance outcome.

## Methods

The current study uses the public use version of the ADD Health Wave 5 survey data, which was collected from 2016 through 2018. The sample includes `r nrow(wave5_clean)` adult participants.

```{r}
#| label: paper-table-1

# descriptive table of race, ethnicity, income, employment, gender, health insurance status?


```


```{r}
#| label: paper-figure-1


```


```{r}
#| label: paper-figure-2


```

## Results

## Discussion

## Reference


