---
title: "Understanding demographic variations in health insurance coverage in the United States: evidence from wave 5 of ADD Health survey"
subtitle: "EDLD 651 Final Paper"
author: "Sara Kiros, Ohnmar Khine Min, Chen Su"
bibliography: references.bib
link-citations: true
format: 
  html:
    toc: true
execute: 
  eval: true
  echo: false
  warning: false
fig-width: 6.5
fig-height: 8
---



```{r}
#| label: load-packages-raw-data

#install.packages("webshot2")
#install.packages("labeled")
library(tidyverse)
library(here)
library(rio)
library(janitor)
library(gt)
library(labelled)
library(webshot2)

pwave5 <- import(here("data", "pwave5.xpt")) |>
  characterize() |>
  clean_names() 

```



```{r}
#| label: select-variables

wave5_raw <- pwave5 |>
     select(aid, imonth5, iyear5, h5od1m, h5od1y,
            h5od2a, h5od4a, h5od4b, h5od4c,
            h5od4d, h5od4e, h5od4f, h5od4g, h5od8,
            h5lm5, h5lm6, h5lm7, h5lm9, h5ec2,
            h5id9, h5id10a, h5id10b, h5id10c, h5id10d)

```



```{r}
#| label: clean-employment

#Job Type
job_labels <- c(
  "1" = "Military", 
  "2" = "Private for-profit", 
  "3" = "Private nonprofit",
  "4" = "Local government",
  "5" = "State government", 
  "6" = "Federal government", 
  "7" = "Self-employed (non-inc)",
  "8" = "Self-employed (inc)",
  "9" = "Unpaid family worker"
  )


wave5_clean <- wave5_raw |> 
    mutate(
    employed = ifelse(h5lm5 == 1, "Employed",
                      ifelse(h5lm5 %in% c(2, 3), "Not employed", NA)),
    num_jobs = ifelse(h5lm6 %in% 1:4, h5lm6, NA),
    hours_work = ifelse(h5lm7 >= 5 & h5lm7 <= 90, h5lm7, NA),
     job_type = job_labels[as.character(h5lm9)]
)

wave5_clean$job_type <- as.factor(wave5_clean$job_type)
wave5_clean$employed <- as.factor(wave5_clean$employed)

```



```{r}
#| label: clean-sex

wave5_clean <- wave5_clean |> 
  mutate(
    sex = ifelse(h5od2a == 1, "Male", 
                    ifelse(h5od2a == 2, "Female", NA))
  )

#sex_employment
sex_employment <- wave5_clean |> 
  group_by (sex, employed) |>
  summarize(n = n(), .groups = "drop")

# removing missing

sex_employment <- na.omit(sex_employment)

```



```{r}
#| label: clean-insurance-status

wave5_clean <- wave5_clean %>%
 mutate(insurance_status = case_when(h5id9 == 1 ~ "Insurance Through Work",
                                     h5id9 == 2 ~ "Insurance Through Union",
                                     h5id9 == 4 ~ "Partner's Insurance",
                                     h5id9 == 6 ~ "Active Duty Military Insurance",
                                     h5id9 == 7 ~ "Self Private Insurance",
                                     h5id9 == 8 ~ "Self Marketplace or ACA Insurance",
                                     h5id9 == 9 ~ "Medicaid",
                                     h5id9 == 10 ~ "Medicare",
                                     h5id9 == 11 ~ "Department of Veterans Affairs",
                                     h5id9 == 12 ~ "Military Healthcare Plans",
                                     h5id9 == 13 ~ "Indian Health Service",
                                     h5id9 == 14 ~ "Unknown Health Insurance",
                                     h5id9 == 15 ~ "No Health Insurance"
                                     ))
  
wave5_clean$insurance_status <- as.factor(wave5_clean$insurance_status)

# no insurance reason 
wave5_clean <- wave5_clean %>%
 mutate(notinsured_reason = case_when(h5id10a == 1 ~ "Not offered via work or school",
                                     h5id10b == 1 ~ "Too expensive",
                                     h5id10c == 1 ~ "Do not need or want insurance",
                                     h5id10d == 1 ~ "Denied insurance"))


wave5_clean$notinsured_reason <- as.factor(wave5_clean$notinsured_reason)

```



```{r}
#| label: clean-income

#Household Income in the last calendar year (h5ec2)

wave5_clean <- wave5_clean %>%
  mutate(
    household_income_raw = factor(
      h5ec2,
      levels = 1:13,
      labels = c(
        "Less than $5,000",
        "$5,000 to $9,999",
        "$10,000 to $14,999",
        "$15,000 to $19,999",
        "$20,000 to $24,999",
        "$25,000 to $29,999",
        "$30,000 to $39,999",
        "$40,000 to $49,999",
        "$50,000 to $74,999",
        "$75,000 to $99,999",
        "$100,000 to $149,999",
        "$150,000 to $199,999",
        "$200,000 or more"
      )
    )
  )


# collapsing income 

wave5_clean<- wave5_clean %>%
  mutate(
    household_income = fct_collapse(household_income_raw,
       `Below 50k` = c("Less than $5,000", "$5,000 to $9,999", "$10,000 to $14,999", "$15,000 to $19,999","$20,000 to $24,999",
      "$25,000 to $29,999",
      "$30,000 to $39,999",
      "$40,000 to $49,999"),
      `50k-100k` = c("$50,000 to $74,999",
        "$75,000 to $99,999"),
      `100k-200k` = c("$100,000 to $149,999",
        "$150,000 to $199,999"),
      `Above 200k` = c("$200,000 or more")))


```



```{r}
#| label: convert-date-variables

survey_date_string <- paste(wave5_clean$iyear5, wave5_clean$imonth5, 1, sep = "-")

wave5_clean <- wave5_clean |>
  mutate(survey_date = ymd(survey_date_string))


birth_date_string <- paste(wave5_clean$h5od1y, wave5_clean$h5od1m, 1, sep = "-")

wave5_clean <- wave5_clean |>
  mutate(birth_date = ymd(birth_date_string))

```



```{r}
#| label: calculate-age-at-survey

wave5_clean <- wave5_clean |>
  mutate(age = interval(birth_date, survey_date) |>
           time_length(unit = "years") |> round(digits = 2))

wave5_clean |>
  ggplot(aes(x=age)) + geom_histogram(binwidth = 1,
                                      fill="skyblue", color="white", alpha=0.8) + 
  labs(x = "Age at Wave 5",
       y = "Number of Participants",
    title = "Distribution of Participant's Age",
       caption = "Data Source: Wave 5 ADD Health") + 
  theme_minimal()


```



```{r}
#| label: convert-race-ethnicity-variables

wave5_clean <- wave5_clean |>
  mutate(race = case_when(h5od4a == 1 & h5od4b == 0 & h5od4d == 0 & h5od4e == 0 &
                            h5od4f == 0 & h5od4g == 0 ~ "White", 
                          h5od4a == 0 & h5od4b == 1 & h5od4d == 0 & h5od4e == 0 &
                            h5od4f == 0 & h5od4g == 0 ~ "Black", 
                          h5od4a == 0 & h5od4b == 0 & h5od4d == 1 & h5od4e == 0 &
                            h5od4f == 0 & h5od4g == 0 ~ "Asian", 
                          h5od4a == 0 & h5od4b == 0 & h5od4d == 0 & h5od4e == 1 &
                            h5od4f == 0 & h5od4g == 0 ~ "Pacific Islander", 
                          h5od4a == 0 & h5od4b == 0 & h5od4d == 0 & h5od4e == 0 &
                            h5od4f == 1 & h5od4g == 0 ~ "American Indian or Alaska Native",
                          h5od4a == 0 & h5od4b == 0 & h5od4d == 0 & h5od4e == 0 &
                            h5od4f == 0 & h5od4g == 1 ~ "Other Race"))

# NA = multiple race selected, recode to multiracial
wave5_clean <- wave5_clean |>
  mutate(race = replace_na(race, "Multiracial"))


# ethnicity
wave5_clean <- wave5_clean |>
  mutate(ethnicity = case_when(h5od4c == 1 ~ "Hispanic",
                               h5od4c == 0 ~ "Non-Hispanic"))

# NA = Missing for ethnicity
wave5_clean <- wave5_clean |>
  mutate(ethnicity = replace_na(ethnicity, "Missing"))
    
# re-level variables
wave5_clean$race <- factor(wave5_clean$race,levels = c("White",
                                                       "Black",
                                                       "Asian",
                                                       "Pacific Islander",
                                                       "American Indian or Alaska Native",
                                                       "Multiracial",
                                                       "Other Race"))

wave5_clean$ethnicity <- factor(wave5_clean$ethnicity,
                                levels = c("Non-Hispanic",
                                           "Hispanic",
                                           "Missing"))

```


**remove at the end before submitting**
```{r}
#| label: visual-race-ethnicity

wave5_clean |>
  ggplot(aes(race)) + geom_bar(fill = "darkgreen") + 
  labs(title = "Distribution of Participant's Race and Ethnicity",
       caption = "Data Source: Wave 5 ADD Health") + 
  theme_minimal() + facet_wrap(~ethnicity) + coord_flip()

# just race
wave5_clean |>
  ggplot(aes(race)) + geom_bar(fill = "darkgreen") + 
  labs(title = "Distribution of Participant's Race",
       caption = "Data Source: Wave 5 ADD Health") + 
  theme_minimal() + coord_flip()

# just ethnicity
wave5_clean |>
  ggplot(aes(ethnicity)) + geom_bar(fill = "darkorange") + 
  labs(title = "Distribution of Participant's Ethnicity",
       caption = "Data Source: Wave 5 ADD Health") + 
  theme_minimal() + coord_flip()

# table
 wave5_clean |>
  count(race, ethnicity) |>
  group_by(ethnicity) |>
  gt() |>
  tab_header(title = "Descriptive Statistics: Race and Ethnicity") |>
  cols_label(
    race = "Race",
    ethnicity = "Ethnicity"
    )


```




## Abstract
[1-2 Sentences about study rationale --> Access to health services has been identified as a social determinant of health by the Office of Disease Prevention and Health Promotion [@HealthyPeople2030]. Status on health insurance coverage is a factor that largely contributes to accessing healthcare services, for both treatment and preventative services. 


The current study examines the variations of health insurance status across demographic characteristics including race, ethnicity, age, sex, employment, income using Wave V of ADD Health survey data. [summarize finding here: We found that....]. It is critical to address disparities in health insurance status as improved access to care for diverse population is crucial for the successful prevention and management of chronic health conditions for all.

## Introduction
(1-2 paragraphs) Describe here why we are examining these demographic variables and health insurance outcome.

Many adverse outcomes can result from a lack of health insurance coverage. Uninsured adults are less likely to receive preventative screenings for chronic conditions, such as cancer, cardiovascular disease, and diabetes, resulting in higher mortality among uninsured groups due to untimely diagnoses and treatments [@IOM2009]. In addition, thereâ€™s a higher likelihood of medical debt among uninsured groups due to accrued out-of-pocket expenses [@Herman2011]. Access to health insurance coverage is unequally distributed across people with lower incomes, racial/ethnic minorities,gender minorities, and young adults [@Hadley2003]. Particularly, disparities across health insurance coverage primarily affect people in lower-income classes or in minority groups, as about half of the uninsured population in the U.S. are also in lower-income classes or in a minority group [@Majerol2015].


## Methods

The current study uses the public available version of the ADD Health Wave 5 survey data, which was collected from 2016 through 2018. The sample includes `r nrow(wave5_clean)` adult participants.

```{r}
#| label: paper-table-1

# descriptive table of race, ethnicity, income, employment, gender, health insurance status?


```

```{r}
#| label: paper-table-2

# descriptive table of race, ethnicity, income, employment, gender, health insurance status?


```


```{r}
#| label: paper-figure-1


```


```{r}
#| label: paper-figure-2


```

```{r}
#| label: paper-figure-3


```

```{r}
#| label: paper-figure-4


```

```{r}
#| label: paper-figure-5


```

**code copied from data script draft that we can build off of for final paper, Delete at the end**

```{r}

# Data Exploratory visualization for Household Income Count

wave5_clean %>%
  filter(!is.na(household_income)) %>%
  group_by(household_income) %>%
  summarise(count = n()) %>%
  ggplot(aes(household_income, count)) +
  geom_col() +
  labs(title = "Count by Income Level", x = "Household Income Level", y = "Count") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


#Distribution of Job Types - Bar Chart
ggplot(wave5_clean, aes(x = job_type)) + 
  geom_bar() +
  coord_flip() + 
  labs(title = "Distribution of Job Types Among Participants", 
       x = "Job Type", 
       y = "Count")

#sex_employment plot
ggplot(sex_employment, aes(x = sex, y = n, fill = employed)) + 
  geom_col(position = "dodge", na.rm = TRUE) + 
  labs(title = "Employment Status by Sex", 
       x = "Sex",
       y = "Count",
       fill = "Employment")

# example of creating a subset of our data or a new data frame first then making tables or graphs
sex_employment <- wave5_clean |> 
  group_by (sex, employed) |>
  summarize(n = n(), .groups = "drop")



#hashtagged out for now to check rendering and citations

# table formatting
#gt() %>%
  #tab_header(title = "") %>%
  #cols_label(
    #household_income = "",
    #count = "",
    #percent = ""
  #) %>%
  #fmt_percent(columns = percent, decimals = 1) %>%
  #cols_align(align = "left", columns = household_income) %>%
  #cols_align(align = "right", columns = c(count, percent))
  
  


```

## Results

We used the following packages [@R; @here;@tidyverse;@rio;@janitor;@gt;@labelled;@webshot2] to assist our coding. 

## Discussion

## References



